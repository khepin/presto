(function(){function a(a,b){function c(a,b){var c={};f(c,this);var d=this[p]?this[p]+"/":"";return a=o.urlMap[a]||a,c[p]=i(d+a+"/"+b),c}function d(a){var b={};f(b,this);var c=this[p]?this[p]+"/":"";return a=o.urlMap[a]||a,b[p]=i(c+a),b}function e(a,b){return _.each(_.keys(b.prestoFields),function(c){var d=b.prestoFields[c];d.fn&&(a[d.name]=_.bind(d.fn,a))}),a}function f(a,b){e(a,o);var c=[],d=o.prestoFields;_.each(_.keys(d),function(a){d[a].fn||c.push(d[a].name)}),_.defaults(a,_.pick(b,c))}function g(a,b){_.each(a,function(a){f(a,b),a[p]=i(a[p]+"/"+a[o.idAttribute])})}function h(){if(!_.isArray(this)){var a=o.prestoFields,b=[];return _.each(_.keys(a),function(c){b.push(a[c].name)}),JSON.stringify(_.omit(this,b))}}function i(a,b){return b&&(a+="?"+$.param(b)),a.replace("//","/")}function j(a,b){var c=$.ajax(a);return c.then(function(a){_.isArray(a)&&g(a,b),f(a,b)}),c}function k(a){var b={url:i(this[p],a),method:"GET"};return b=_.defaults(b,o.ajax),j(b,this)}function l(a,b){var c={url:i(this[p],b),method:"POST",data:JSON.stringify(a),dataType:"json",contentType:"application/json; charset=utf-8"};return c=_.defaults(c,o.ajax),j(c,this)}function m(a){var b={url:i(this[p],a),method:"PUT",data:this.$serialize(),dataType:"json",contentType:"application/json; charset=utf-8"};return b=_.defaults(b,o.ajax),j(b,this)}function n(a){var b={url:i(this[p],a),method:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json"};return b=_.defaults(b,o.ajax),j(b,this)}var o={prestoFields:{get:{name:"$get",fn:k},put:{name:"$put",fn:m},post:{name:"$post",fn:l},"delete":{name:"$delete",fn:n},serialize:{name:"$serialize",fn:h},one:{name:"$one",fn:c},all:{name:"$all",fn:d},path:{name:"$path"}},ajax:{dataType:"json",contentType:"application/json; charset=utf-8"},baseUrl:"",idAttribute:"id",urlMap:{}};o=_.defaults(a||{},o),(b||_.identity)(o);var p=o.prestoFields.path.name;this[p]=o.baseUrl,this[o.prestoFields.one.name]=_.bind(c,this),this[o.prestoFields.all.name]=_.bind(d,this)}var b="undefined"!=typeof module&&module.exports;b&&(module.exports=a),"undefined"==typeof ender&&(this.presto=a),"function"==typeof define&&define.amd&&define("presto",[],function(){return a})}).call(this);